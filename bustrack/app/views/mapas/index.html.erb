<div id="header" style="margin-bottom:0px;border-width:5px;border-style:double;border-radius: 15px;border-top-left-radius: 10px;font-family:Book Antiqua; width:100%;height: 77px;color:#ffffff" xmlns="http://www.w3.org/1999/html">

  <h2 style="margin-left: 15px"><strong>BUS TRACK</strong></h2>
  <p style="margin-left: 15px;font-family: Brush Script MT;"><i><font size="4">Que no te deje el bus</font></i></p>

</div>

    }

<script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.15/firebase.js'></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<!-- <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script> -->

<script>
    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    var map;
	var busGranadilla1;
	var busGranadilla2;
    var busPipiolo;
    var busExpreso;

    // Initialize esta funcion coloca el mapa en la posicion de nuestra preferencia Latitud Longuitud y ademas podemos agregar el zoom incial
    function initialize() {
        directionsDisplay = new google.maps.DirectionsRenderer();
        var san_jose = new google.maps.LatLng(9.9333333, -84.0833333);
        var mapOptions = {
            zoom: 10,
            center: san_jose
        }
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        directionsDisplay.setMap(map);

		 busGranadilla1 = new google.maps.Marker({
			position: new google.maps.LatLng(0, 0.1),
			map: map,
			title:"Granadilla - San José"
	      });
		  
		 busGranadilla2 = new google.maps.Marker({
			position: new google.maps.LatLng(0, 0.2),
			map: map,
			title:"Granadilla - San José"
	      });
		  
		  busPipiolo = new google.maps.Marker({
			  position: new google.maps.LatLng(0, 0.3),
			  map: map,
			  title:"UCR - Pipiolo"
	      });
		  
		  busExpreso = new google.maps.Marker({
			  position: new google.maps.LatLng(0, 0),
			  map: map,
			  title:"Expreso Periferica"
	      });
    }

    //aqui lo que se hace es montar las direcciones entre paradas ademas de dibujar las rutas
    function calcRoute() {
        var start = document.getElementById('start').value;
        var end = document.getElementById('end').value;
        var waypts = [];
        var checkboxArray = document.getElementById('waypoints');
//en este for se verifican las opciones marcadas de las paradas y se agreagan a la variable waypts
        for (var i = 0; i < checkboxArray.length; i++) {
            if (checkboxArray.options[i].selected == true) {
                waypts.push({
                    location:checkboxArray[i].value,
                    stopover:true});
            }
        }
//var request es la variable mas importante ya que en ella se colocan el principio y el final de las rutas ademas de que los waypts que en nuestro caso lo veria como paradas
        var request = {
            origin: start,
            destination: end,
            waypoints: waypts,
            optimizeWaypoints: false,
            travelMode: google.maps.TravelMode.DRIVING
        };
//aque se llama al metodo para dibujar el mapa
        directionsService.route(request, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                var route = response.routes[0];
                var summaryPanel = document.getElementById('directions_panel');
                summaryPanel.innerHTML = '';
                // For each route, display summary information.
                for (var i = 0; i < route.legs.length; i++) {
                    var routeSegment = i + 1;
                    summaryPanel.innerHTML += '<b>Segmento de ruta: ' + routeSegment + '</b><br>';
                    summaryPanel.innerHTML += route.legs[i].start_address + ' hacia ';
                    summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                    summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                }
            }
        });
    }

	var firebaseRef = new Firebase('https://blazing-fire-9075.firebaseio.com');
	
	firebaseRef.on('child_changed', function(snapshot) {
		var message = snapshot.val();
		//console.log(message);
		var device = message.GpsID;
		//console.log(device);
		var location = message.Location;
		//console.log(location);
		
		var tokens = location.split(" ");
		var mylat = tokens[0];
		var mylong = tokens[1];
		var myLatlng = new google.maps.LatLng(mylat,mylong);
		
		if(device == '3a1bb1eb-be18-41db-9a2b-562506c86fef'){
			busGranadilla1.setPosition(myLatlng);
		}
		else if(device == 'a79db0be-5606-43a3-816b-d8c9144b1985'){
			busGranadilla2.setPosition(myLatlng);
		}
		
 		else if(device == 'cceed289-d438-41ed-a7e5-5e52c61ef1d0'){
			busPipiolo.setPosition(myLatlng);
		}
		
	});
	
	

    google.maps.event.addDomListener(window, 'load', initialize);
    //En este script se le colocan las variables start waypoint y end con estas se llenara request en el funcion calcroute que es llamada cuando le hacemo submit
    // Para HTML5 Encontre esta pagina que funciona bastante bien


</script>
<div  id="menu">
  <ul>
    <li><a href='index.html'><span>Home</span></a></li>
    <li><a href='#'><span>Products</span></a>
      <ul>
        <li><a href='#'><span>Product 1</span></a>
          <ul>
            <li><a href='#'><span>Sub Item</span></a></li>
            <li class='last'><a href='#'><span>Sub Item</span></a></li>
          </ul>
        </li>
        <li><a href='#'><span>Product 2</span></a>
          <ul>
            <li><a href='#'><span>Sub Item</span></a></li>
            <li><a href='#'><span>Sub Item</span></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href='#'><span>About</span></a></li>
    <li class='last'><a href='#'><span>Contact</span></a></li>
  </ul>
</div>
<div id="map-canvas" style="float:left;width:70%;height:100%;"></div>
<div id="control_panel" style="float:right;width:20%;text-align:left;padding-top:20px">
  <div style="margin:20px;border-width:2px;">
    <b>Start:</b>
    <select id="start">
      <option value="9.920974, -84.103341">Hatillo</option>
    </select>
    <br>
    <b>Waypoints:</b> <br>
    <i>(Ctrl-Click for multiple selection)</i> <br>
    <select multiple id="waypoints">
      <option value="9.918549,-84.104548">Parada0</option>
      <option value="9.913507,-84.103476">Parada1</option>
      <option value="9.915801,-84.102586">Parada2</option>
      <option value="9.939051,-84.051768">Parada3</option>
    </select>
    <br>
    <b>End:</b>
    <select id="end">
      <option value="9.935149,-84.051142">UCR</option>
    </select>
    <br>
    <input type="submit" onclick="calcRoute();">
  </div>
  <div id="directions_panel" style="margin:20px;background-color:#FFEE77;"></div>
</div>
<div id="footer">
  Copyright © Bus Track
</div>

	<script>

	

</script>    

